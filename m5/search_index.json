[
["index.html", "Valoriser ses données avec R Chapitre 1 Introduction", " Valoriser ses données avec R Maël Theulière &amp; Murielle Lethrosne 25 August 2019 Chapitre 1 Introduction Crédit photographique Sébastien Colas Ce module va vous permettre de découvrir un ensemble de méthodes sous R afin de produire : Des tableaux Des graphiques Des cartes R permet de faire tout cela. Et le plus important, il permet de le faire de façon reproductible. C’est à dire qu’un programme bien conçu permet d’être reproduit par une autre personne à partir des mêmes données mises à jour. Il vous permet également d’insérer ces valorisations dans un rapport ou une application via les packages Rmarkdown et Shiny qui sont au programme d’autres modules de formation. "],
["un-typologie-des-representations-graphiques.html", "Chapitre 2 Un typologie des représentations graphiques", " Chapitre 2 Un typologie des représentations graphiques #wrap { width: 600px; height: 390px; padding: 0; overflow: hidden; } #frame { width: 800px; height: 520px; border: 1px solid black; } #frame { zoom: 0.50; -moz-transform: scale(0.50); -moz-transform-origin: 0 0; } Nous verrons par la suite les différentes formes de représentations graphiques suivant la typologie suivante des principales variables utilisées : Représentation d’une variable continue Représentation d’une variable disrète Représentation de deux variables continues Représentation d’une variable continue et d’une variable discrète Représentation de deux variables discrètes Représentation des polygones (cartes) On trouve une compilation très complète des graphiques sur le site from Data to Viz "],
["bien-commencer.html", "Chapitre 3 Bien commencer 3.1 Créer un projet sous Rstudio pour vous permettre de recencer vos travaux. 3.2 Intégrer vos données 3.3 Créer votre arborescence de projet 3.4 Activer les packages nécessaires 3.5 Bien structurer ses projets data", " Chapitre 3 Bien commencer 3.1 Créer un projet sous Rstudio pour vous permettre de recencer vos travaux. Pourquoi travailler avec les projets Rstudio plutôt que les scripts R ? Cela permet la portabilité : le répertoire de travail par défaut d’un projet est le répertoire où est ce projet. Si vous transmettez celui-ci à un collègue, le fait de lancer un programme ne dépend pas de l’arborescence de votre machine. Fini les setwd(&quot;chemin/qui/marche/uniquement/sur/mon/poste&quot;) ! Toujours sur la portabilité, un projet peut être utilisé avec un outil comme packrat qui va internaliser dans le projet l’ensemble des packages dont vous aurez besoin pour celui-ci. Cela permet donc à votre collègue, à qui vous passez votre projet, de ne pas avoir à les installer et surtout si vous mettez à jour votre environnement R, votre projet restera toujours avec les versions des packages avec lesquelles vous avez fait tourné votre projet à l’époque. Cela évite d’avoir à surbir les effets d’une mise à jour important d’un package qui casserait votre code. Pour activer packrat sur un projet, aller dans Tools/Project Options-&gt;Packrat En savoir plus sur Packrat Cela permet de se forcer à travailler en mode projet : on intègre à un seul endroit tout ce qui est lié à un projet : données brutes, données retravaillées, scripts, illustrations, documentations, publications… et donc y compris package avec packrat. On peut travailler sur plusieurs projets en même temps, Rstudio ouvre autant de sessions que de projet dans ce cas. Les projets Rstudio intègrent une interface avec les outils de gestion de version git et svn. Cela veut dire que vous pouvez versionniser votre projet et l’héberger simplement comme répertoire sur des plateformes de gestion de code telle que github ou gitlab. Pour créer un projet : Cliquez sur Project en haut à droite puis New Project. Cliquez sur New Directory. 3.2 Intégrer vos données Une bonne pratique est de créer un sous répertoire /data pour stocker les données sur lesquelles vous aurez à travailler. Vous pouvez le faire de l’explorateur de fichiers de votre système d’exploitation ou directement à partir de l’explorateur de fichiers de RStudio. Cela marche bien quand on a un seul type de données, mais en général on va avoir à travailler sur des données brutes que l’on va retravailler ensuite et vouloir stocker à part. Si par la suite vous souhaitez avoir des exemples de bonnes pratiques sur comment structurer vos données, vous pouvez vous référer au chapitre data du livre d’Hadley Wickham sur la construction de package R (tout package R étant aussi un projet !) 3.3 Créer votre arborescence de projet Créer un répertoire /src ou vous mettrez vos scripts R. Créer un répertoire /figures ou vous mettrez vos illustrations issues de R. 3.4 Activer les packages nécessaires Commencer par rajouter un script dans le répertoire /src à votre projet qui commencera par : activer l’ensemble des packages nécessaires charger les données dont vous aurez besoins. library(knitr) library(kableExtra) library(ggplot2) library(tidyverse) library(hrbrthemes) library(stringr) library(purrr) library(sf) library(tmap) library(viridis) library(scales) library(tmaptools) library(highcharter) library(leaflet) library(cowplot) library(waffle) library(glue) library(gganimate) library(htmlwidgets) load(&quot;data/data_exercices_formation.RData&quot;) load(&quot;data/ODD.RData&quot;) 3.5 Bien structurer ses projets data Plusieurs documents peuvent vous inspirer sur la structuration de vos projets data par la suite. En voici quelques uns : https://github.com/pavopax/new-project-template https://nicercode.github.io/blog/2013-04-05-projects/ https://www.inwt-statistics.com/read-blog/a-meaningful-file-structure-for-r-projects.html http://projecttemplate.net/architecture.html À partir du moment où quelques grands principes sont respectés (un répertoire pour les données brutes en lecture seule par exemple), le reste est surtout une question d’attirance plus forte pour l’une ou l’autre solution. L’important est de vous tenir ensuite à garder toujours la même structure dans vos projets afin de vous y retrouver plus simplement. "],
["presentation-du-package-ggplot2.html", "Chapitre 4 Présentation du package ggplot2 4.1 ggplot2 4.2 Le Tidyverse 4.3 ggplot 2 : les concepts clefs", " Chapitre 4 Présentation du package ggplot2 4.1 ggplot2 ggplot 2 est un package créé par Hadley Wickham et Winston Chang pour implémenter dans R la vision développée par Leland Wilkinson dans The Grammar of Graphics (Statistics and Computing) de la conception de graphiques. Le but est de fournir une approche unique pour produire quasiment toute valorisation graphique de données que l’on peut trouver dans des revues scientifiques, les journaux, dans l’analyse statistique ou la data visualisation. Ce package s’inscrit aujourd’hui dans R par le framework tidyverse qui propose une approche cohérente entre l’importation et la préparation des données, leur analyse et leur valorisation. 4.2 Le Tidyverse le tidyverse 4.3 ggplot 2 : les concepts clefs Pour construire un graphique avec ggplot, il va falloir lui définir plusieurs éléments : la donnée : ggplot2 permet de travailler sur des vecteurs, des dataframes, des tibbles, ou des données spatiales ; le mapping : on définit dans l’aesthetic (ou aes) le mapping, c’est à dire ce que l’on veut représenter qui dépend des variables (quelle variable sur l’axe x, sur l’axe y, quelle variable pour définir une graduation de couleurs…) ; les paramètres : on définit les autres paramètres qui dépendent de constantes (par exemple : je veux que toutes mes lignes soient rouge ou de taille 2 pixels) ; le layer (“forme géométrique”) : on définie sous quelle représentation graphique on représente les paramètres précédents. Sous ggplot, ces fonctions sont de la forme geom_XX ; L’écriture type d’un graphique sera donc: ggplot(data = &lt;DATA&gt;) + &lt;FORME_GEO&gt;(mapping = aes(&lt;MAPPINGS&gt;),...=&lt;PARAMS&gt;) On va ensuite pouvoir à partir de cette base pour enrichir avec des fonctions supplémentaires. Chaque fonction s’enchaine avec des + comme les pipe. ggplot(data = &lt;DATA&gt;) + &lt;FORME_GEO&gt;(mapping = aes(&lt;MAPPINGS&gt;),...=&lt;PARAMS&gt;)+ &lt;FONCTION1&gt;+ ... "],
["le-mapping.html", "Chapitre 5 Le mapping 5.1 Les paramètres du mapping 5.2 Les “autres” paramètres 5.3 Exercice 1", " Chapitre 5 Le mapping 5.1 Les paramètres du mapping Dans l’exemple qui suit, la représentation géographique utilisée est le nuage de points geom_point. D’autres types de représentations géographiques sont présentés dans la partie suivante. L’aesthetic sert à identifier les variables que l’on souhaite représenter. Par exemple, si l’on souhaite représenter le taux de mortalité maternelle (Maternal_mortality_ratio) en fonction du produit intérieur brut (Gross_Domestic_Product_GDP) : ggplot(data = graphique1) + geom_point(aes(x=Gross_Domestic_Product_GDP,y=Maternal_mortality_ratio)) De plus, la fonction aes admet d’autres arguments qui permettent de modifier l’apparence du graphique selon une 3ème variable du jeu de données. colour : la couleur, shape : la forme, size : la taille, alpha : la transparence, fill : le remplissage ; ggplot(data = graphique1) + geom_point(aes(x=Gross_Domestic_Product_GDP,y=Maternal_mortality_ratio,colour=Continent)) 5.2 Les “autres” paramètres Il est possible de spécifier des paramètres qui seront valables pour l’ensemble du graphique. On retrouve entre autre les mêmes paramètres proposés dans l’aes, mais il faut alors les passer en dehors de l’aesthetic. Par exemple, si l’on souhaite modifier la transparance et la taille de l’ensemble des points du graphique précédent: ggplot(data = graphique1) + geom_point(aes(x=Gross_Domestic_Product_GDP,y=Maternal_mortality_ratio,colour=Continent), alpha=0.5,size=1.9) De même si l’on souhaite modifier la couleur générale : ggplot(data = graphique1) + geom_point(aes(x=Gross_Domestic_Product_GDP,y=Maternal_mortality_ratio), color=&quot;red&quot;) Pour choisir et modifier facilement les couleurs d’un graphe, il existe un addin développé par Dean Attali: Colour Picker Il est installable comme n’importe quel package. Pour plus d’informations: https://github.com/daattali/colourpicker 5.3 Exercice 1 A partir des données de la table rpls_aggrege_large (dans le data_exercices_formation.RData), créer un nuage de point entre : le % de parc social de moins de 5 ans; et le pourcentage de logement avec un DPE ges de classe A,B ou C; et une couleur différente pour distinguer les epci de la région PDL. Le résultat attendu : "],
["les-formes-geometriques.html", "Chapitre 6 Les formes géométriques", " Chapitre 6 Les formes géométriques Pour spécifier le type de représentation que l’on souhaite, il faut utiliser les fonctions de la forme geom_XX Le tableau ci-dessous présente quelques représentations graphiques classiques. Il en existe un grand nombre que l’on peut retrouver grâce à l’aide help.search(&quot;^geom_&quot;, package = &quot;ggplot2&quot;) GEOM DESCRIPTION geom_point() Nuage de points geom_line() Ligne geom_bar() Diagramme en barres geom_histogram() Histogramme geom_boxplot() Boîte à moustaches geom_density() Courbe de densité ggplot(data = graphique1) + geom_bar(aes(Continent)) ggplot(graphique1) + geom_histogram(aes(x=log(Gross_Domestic_Product_GDP))) ggplot(graphique1) + geom_density(aes(x=log(Gross_Domestic_Product_GDP))) ggplot(graphique2) + geom_line(aes(x=Year,y=Value)) "],
["lhabillage-simple.html", "Chapitre 7 L’habillage simple 7.1 Titre et libellé des axes 7.2 Légende 7.3 Annotation", " Chapitre 7 L’habillage simple 7.1 Titre et libellé des axes Chaque nouvel élément graphique est à rajouter sous forme de layer. Ici, nous utilisons la fonction labs qui permet de labelliser tous les éléments possibles de l’aesthétic, ainsi que le titre (title), le sous titre (subtitle) et le bas de page (caption) ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) À noter qu’il existe plusieurs autres façons de spécifier ces élèments par des couches spécifiques: ggtitle, xlab, ylab,… 7.2 Légende Les fonctions guide() et guides permettent de modifier finement la légende. Les guides peuvent être spécifiés dans chaque scale_* ou dans une instruction guides. ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;)+ guides(color=guide_legend(direction=&quot;horizontal&quot;, order=1, title.position=&quot;top&quot;, title.hjust=0.5, nrow=1, label.position=&quot;bottom&quot;))+ theme(legend.position = &quot;bottom&quot;) 7.3 Annotation Il est aussi possible de rajouter des annotations de type texte, par exemple, “à la volée”. ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;)+ annotate(&quot;text&quot;, x = 6, y = 2, label = &quot;je rajoute mon texte&quot;,color=&quot;blue&quot;) La fonction annotate permet aussi d’ajouter d’autres types d’annotation comme par exemple des rectangles : ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;)+ annotate(&quot;rect&quot;, xmin = 10, xmax = Inf, ymin = -Inf, ymax = Inf,fill=&quot;red&quot;,alpha=0.2)+ annotate(&quot;rect&quot;, xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = 2,fill=&quot;green&quot;,alpha=0.2) "],
["les-themes.html", "Chapitre 8 Les thèmes 8.1 Les fonctions “élément” 8.2 Les composantes 8.3 Quelques exemples 8.4 Modifier le thème par défaut. 8.5 Créer son propre thème 8.6 Exercice 2", " Chapitre 8 Les thèmes Pour modifier simplement la position de la légende, c’est la fonction theme() qu’il faut utiliser. theme permet de créer des templates, c’est-à-dire de définir tout ce qui n’est pas lié directement aux données sur un graphique, notamment: la position, taille, couleur, police des éléments textuels la couleur des grilles primaires et secondaires du graphique Il existe des thèmes prédéfinis dans ggplot que l’on peut déjà utiliser. Par exemple : theme_classic(), theme_bw(), theme_dark(), … Des packages externes permettent d’enrichir cette collection de thèmes, par exemple ggthemes ou hrbrthemes. Lorsque l’on souhaite garder une cohérence entre plusieurs graphiques, le mieux est d’en définir un à part pour l’appeler ensuite. 8.1 Les fonctions “élément” Elle utilise 4 types de fonctions : element_text() : pour toutes les étiquettes PARAMÈTRE VALEUR family la famille de la police face le type de police (“plain”, “italic”, “bold”, “bold.italic”) colour couleur size taille en points hjust justification horizontale, dans [0, 1] vjust justification verticale, dans [0, 1] angle angle, dans [0, 360] lineheight hauteur de ligne (pour l’espacement entre les lignes) element_rect() : pour les fonds et les cadres, PARAMÈTRE VALEUR fill la couleur de remplissage colour la couleur de la bordure size la taille de la bordure linetype le type de ligne (“blank”, “solid”, “dashed”, “dotted”, “dotdash”, “longdash”, &quot;twodash) element_line() : pour toutes les lignes tracées, PARAMÈTRE VALEUR colour la couleur de ligne size la taille linetype le type de ligne (“blank”, “solid”, “dashed”, “dotted”, “dotdash”,“longdash”, &quot;twodash) lineend le type de fin de ligne (“round”, “butt” ou “square”) element_blank() : permet de ne rien dessiner. 8.2 Les composantes Il s’agit des différents éléments modifiables dans le thème. Par exemple : Axes axis.line, axis.text.x, axis.text.y, axis.ticks, axis.title.x, axis.title.y,… Légende legend.background, legend.key, legend.text, legend.title,… Fond de graphe panel.background, panel.border, panel.grid.major, panel.grid.minor,… etc 8.3 Quelques exemples Changer le fond du graphique panel_background ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) + theme(panel.background = element_rect(fill=&quot;Lavender&quot;,colour=&quot;black&quot;)) Changer l’apparence du quadrillage panel_background ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) + theme(panel.grid.major = element_line(colour=&quot;gray&quot;,size=0.5,linetype=&quot;dashed&quot;)) Changer l’apparence des étiquettes des axes axis_xxx() ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) + theme(axis.text.x = element_text(colour = &quot;blue&quot;, angle = 45), axis.title = element_text(face = &quot;bold&quot;, colour = &quot;orange&quot;)) Certains changements de paramètres ne nécessitent pas l’utilisation de fonction element_() . Par exemple, pour changer la position de la légende legend.xxx() ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) + theme(legend.position=&quot;left&quot;,legend.title=element_blank()) 8.4 Modifier le thème par défaut. La fonction theme_set() vous permet de définir un thème par défaut pour l’ensemble de vos graphiques. theme_set(theme_dark()) ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) 8.5 Créer son propre thème Un thème est une fonction R qui va prendre en paramètre des éléments que vous souhaitez pouvoir faire varier et fixer des éléments que vous souhaitez avoir comme rendu par défaut. Créons un thème avec un fond vert pour le ministère de la transition écologique et solidaire. On rajoute un paramètre pour la taille de la police du titre du graphique. library(hrbrthemes) theme_mtes&lt;-function(taille_police=14){ theme_bw()+ theme(plot.title = element_text(color = &quot;white&quot;,size=taille_police,face=&quot;bold&quot;), text = element_text(color=&quot;white&quot;), axis.text = element_text(color=&quot;white&quot;), panel.background = element_rect(fill=&quot;lightgreen&quot;,colour=&quot;lightgreen&quot;), plot.background= element_rect(fill=&quot;#006400&quot;,colour=&quot;lightgreen&quot;), legend.background = element_rect(fill=&quot;lightgreen&quot;,colour=&quot;lightgreen&quot;), legend.key = element_blank()) } ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;)+ theme_mtes() 8.6 Exercice 2 A partir des données de la table graphique 1, reprendre le nuage de point obtenu à partir des données ODD : taux de mortalité maternelle (Maternal_mortality_ratio) en fonction du produit intérieur brut (Gross_Domestic_Product_GDP) (Chapitre 4.1) En modifier le thème: Insérer un titre de couleur, en gras, centré par rapport au graphe. Indiquer la source (ODD) et modifier sa taille Changer les titres des axes et leurs tailles. modifier la couleur de fond du graphe modifier le type de gadrillage (pointillés) Le résultat attendu "],
["les-scales.html", "Chapitre 9 Les scales 9.1 Formatage spécifique 9.2 Exercice 3", " Chapitre 9 Les scales Les fonctions scales permettent globalement de paramétrer les éléments rentrés dans l’aesthétic : Si je veux un gradient de couleur fonction d’une variable continue : quelle palette de couleur je choisie, comment je cale mon dégradé en fonction de cette variable continue ? Si je mets une variable continue en ordonnée, comment je définis le minimum et maximum de cette axe, sa position, les valeurs que j’affiche sur l’échelle… L’ensemble des scales possibles peuvent se décrire sous forme suivante: scale_xx_yy ou xx peut être un des paramètres de l’aesthétic : xx description alpha transparence color couleur des lignes ou des points fill couleurs des aires linetype type de ligne (continue,pointillée,…) shape forme des points size aire des points x variable de l’axe x y variable de l’axe y Et y un type de paramétrage : yy description continuous gérer les variables continue discrete gérer les variables discrètes date gérer une variable au format date reverse inverser l’axe log convertire l’échelle d’une variable continue en échelle logarithmique log10 convertire l’échelle d’une variable continue en échelle logarithmique décimale viridis utiliser une palette de couleur viridis brewer utiliser une palette de couleur brewer (variable discrète) distiller utiliser une palette de couleur brewer (variable continue) gradient utiliser un gradient de 2 couleurs gradient2 utiliser un gradient divergent de 3 couleurs ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ scale_color_brewer(type=&quot;qual&quot;) Par exemple on peut exploiter une fonction scale pour définir une échelle logarithimique sur un axe. ggplot(graphique1) + geom_point(aes(x=Gross_Domestic_Product_GDP, y=Maternal_mortality_ratio, color=Continent))+ scale_color_brewer(type=&quot;qual&quot;)+ scale_x_log10()+ scale_y_log10() 9.1 Formatage spécifique Transformation en pourcentage; scale_y_continuous(labels=scales::percent) Ajout du séparateurs des milliers; scale_y_continuous(labels=function(x) format(x,big.mark=&quot; &quot;,scientific = FALSE)) Ajout du symbole €; scale_y_continuous(labels=function(x) paste(x,&quot; €&quot;)) 9.2 Exercice 3 En réutilisant le graphe obtenu à l’exercice 1 (table rpls_aggrege_large), y rajouter: une palette brewer pour la couleur; la légende en bas; des libellés (axes et légende) parlant et un titre. Le résultat attendu "],
["la-mise-en-page-de-plusieurs-graphiques.html", "Chapitre 10 La mise en page de plusieurs graphiques", " Chapitre 10 La mise en page de plusieurs graphiques Le package cowplot permet la combinaison de plusieurs graphiques. Il est composé de plusieurs fonctions. le fonction plot_grid qui permet de disposer n graphes sur i colonnes et j lignes gg1&lt;-ggplot(graphique1) + geom_point(aes(x=Gross_Domestic_Product_GDP, y=Maternal_mortality_ratio))+ scale_x_log10()+ scale_y_log10()+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) + theme(axis.title= element_text(size=9)) gg2&lt;-ggplot(graphique1) + geom_density(aes(x=log(Gross_Domestic_Product_GDP)) ) plot_grid(gg1,gg2, ncol = 1, nrow = 2) le fonction draw_plot associée à ggdraw qui permet de disposer les graphiques à des places spécifiques ggdraw initialise le graphique gg1&lt;-ggplot(graphique1) + geom_point(aes(x=Gross_Domestic_Product_GDP, y=Maternal_mortality_ratio))+ scale_x_log10()+ scale_y_log10()+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU&quot;) + theme(axis.title= element_text(size=9)) gg2&lt;-ggplot(graphique1) + geom_density(aes(x=log(Gross_Domestic_Product_GDP)) )+ labs(x=&quot;Log(PIB)&quot;, y=&quot;Densité&quot;) gg3&lt;-ggplot(data = graphique1) + geom_bar(aes(x=Continent,fill=Continent))+ theme(axis.title.x = element_blank(), axis.text.x = element_blank()) ggdraw() + draw_plot(gg1, x=0, y=.5, width=1, height=.5) + draw_plot(gg2, x=0, y=0, width=.3, height=.5) + draw_plot(gg3, x=0.3, y=0, width=0.7, height=.5) "],
["les-facettes.html", "Chapitre 11 Les facettes 11.1 Exercice 4", " Chapitre 11 Les facettes Lorsque l’on veut pouvoir réaliser un graphique pour plusieurs sous ensemble, les facettes sont alors très utiles. On va ici l’illustrer avec la réalisation du même graphique ci-dessus, mais pour plusieurs années différentes. indicateur311 %&gt;% filter(Type_Zone != &quot;Pays&quot;, Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Location==&quot;Total (national level)&quot;, is.na(Value_type) ) %&gt;% filter(Year %in% c(2000,2005,2010,2015)) %&gt;% ggplot()+ geom_bar(aes(x=Country_or_Area_Name,weight=Value,fill=Country_or_Area_Name))+ theme_ipsum()+ scale_fill_ipsum()+ coord_flip()+ labs(title=&quot;Mortalité maternelle sur quelques zones du globe&quot;, subtitle=&quot;En 2015&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, x=&quot;Zone&quot;, fill=&quot;Zone&quot; )+ theme(legend.position = &quot;none&quot;)+ facet_wrap(~Year) Cet exemple “scinde” notre table en fonction d’une seule variable, mais on peut le faire sur plusieurs variables également. On peut choisir avec facet_wrap : - le nombre de colonnes ou de lignes sur lesquel on veut voir s’afficher le graphique - si on veut fixer l’échelle de l’un ou l’autre des axes ou les deux indicateur311 %&gt;% filter(Type_Zone != &quot;Pays&quot;, Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Location==&quot;Total (national level)&quot;, is.na(Value_type) ) %&gt;% filter(Year %in% c(2000,2005,2010,2015)) %&gt;% ggplot()+ geom_bar(aes(x=Country_or_Area_Name,weight=Value,fill=Country_or_Area_Name))+ theme_ipsum()+ scale_fill_ipsum()+ coord_flip()+ labs(title=&quot;Mortalité maternelle sur quelques zones du globe&quot;, subtitle=&quot;En 2015&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, x=&quot;Zone&quot;, fill=&quot;Zone&quot; )+ theme(legend.position = &quot;none&quot;)+ facet_wrap(~Year,ncol=4) 11.1 Exercice 4 A partir de la table rpls_aggrege, réaliser une facette sur un diagramme barre avec : en variable discrète les régions en variables continues les indicateurs suivants : % de logements de 3 et 4 pièces % DPE énergie A,B,C % DPE GES A,B,C % de parc de moins de 5 ans une façon d’identifier la région Pays de la Loire Pour avoir la liste des modalités dune variable : Variables caractères ou factorielles : unique(rpls_aggrege$Indicateur) Variables factorielles : levels(rpls_aggrege$Indicateur) Résultat attendu "],
["exporter-un-graphique.html", "Chapitre 12 Exporter un graphique", " Chapitre 12 Exporter un graphique ggplot contient une fonction ggsave() qui permet d’exporter nos graphiques au format image dans les formats suivants : eps, ps, tex (pictex), pdf, jpeg, tiff, png, bmp, svg or wmf p&lt;-indicateur311 %&gt;% filter(Type_Zone != &quot;Pays&quot;, Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Location==&quot;Total (national level)&quot;, is.na(Value_type) ) %&gt;% filter(Year %in% c(2000,2005,2010,2015)) %&gt;% ggplot()+ geom_bar(aes(x=Country_or_Area_Name,weight=Value,fill=Country_or_Area_Name))+ theme_ipsum()+ scale_fill_ipsum()+ coord_flip()+ labs(title=&quot;Mortalité maternelle sur quelques zones du globe&quot;, subtitle=&quot;En 2015&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, x=&quot;Zone&quot;, fill=&quot;Zone&quot; )+ theme(legend.position = &quot;none&quot;)+ facet_wrap(~Year,ncol=4) ggsave(&quot;figures/Mortalité maternelle sur quelques zones du globe.svg&quot;,p,width=12,height = 5) "],
["creer-des-cartes-avec-ggplot2-tmap.html", "Chapitre 13 Créer des cartes avec ggplot2, tmap 13.1 Faire des cartes avec ggplot2 13.2 Les cartes avec Tmap 13.3 Exercice 5", " Chapitre 13 Créer des cartes avec ggplot2, tmap 13.1 Faire des cartes avec ggplot2 13.1.1 Les cartes choroplèthes ggplot2 intègre une fonction géométrique permettant l’utilisation de données géomatrique : geom_sf() Le premier exemple que nous allons pouvoir voir, c’est une carte choroplèthe data(&quot;World&quot;) tt&lt;-World %&gt;% rename(Country_or_Area_Code=iso_a3) %&gt;% inner_join(indicateur311 %&gt;% filter(Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Type_Zone==&quot;Pays&quot;, is.na(Value_type)) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(!is.na(Value)) %&gt;% filter(Year==max(Year))) ggplot(data=tt)+ geom_sf(aes(fill=Value)) On peut exploiter de la même façon les différents fonctions vue précédement. Par exemple avec un peu de thème et de facet. data(&quot;World&quot;) World&lt;-st_as_sf(World) tt&lt;-World %&gt;% rename(Country_or_Area_Code=iso_a3) %&gt;% inner_join(indicateur311 %&gt;% filter(Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Type_Zone==&quot;Pays&quot;, is.na(Value_type)) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(!is.na(Value)) %&gt;% filter(Year %in% c(1990,2000,2010,2015)) %&gt;% ungroup() %&gt;% complete(Year) ) ggplot(data=tt)+ geom_sf(aes(fill=log(Value)))+ theme_ipsum()+ scale_fill_viridis(option = &quot;magma&quot;, direction=1, breaks=c(0,1,2,3,4,5,6,7))+ guides(colour=F, order=0, fill=guide_legend(direction=&quot;horizontal&quot;, keyheight=unit(2,units=&quot;mm&quot;), keywidth=unit(20,units=&quot;mm&quot;), order=1, title.position=&quot;top&quot;, title.hjust=0.5, nrow=1, label.position=&quot;bottom&quot;, label.hjust=1))+ theme(legend.position = &quot;bottom&quot;)+ labs(fill=&quot;Log du taux de mortalité infantile&quot;)+ facet_wrap(~Year,drop=T) 13.1.2 Les cartes à ronds proportionnels ggplot ne peut attribuer par défaut un rond proportionnel à un polygone. Pour travailler sur des ronds proportionnels, il faut d’abord créer le centroïde de nos zones, et ensuite tracer un rond proportionnel avec geom_sf. data(&quot;World&quot;) World&lt;-st_as_sf(World) tt&lt;-World %&gt;% rename(Country_or_Area_Code=iso_a3) %&gt;% inner_join(indicateur311 %&gt;% filter(Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Type_Zone==&quot;Pays&quot;, is.na(Value_type)) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(!is.na(Value)) %&gt;% filter(Year==max(Year))) ttc&lt;-st_centroid(tt) ggplot(data=ttc)+ geom_sf(data=tt,fill=&quot;white&quot;)+ geom_sf(aes(color=Value,size=Value)) Attention : les centroïdes ne sont pas forcément là où on le pense. Par exemple, le centroïde de la France est placé en Espagne puisqu’il prend en compte les DOM. 13.2 Les cartes avec Tmap Tmap est un package dédié à la réalisation de cartes sous R. La syntaxe est très proche de ggplot,avec l’opérateur “+” pour enchainer les options. L’équivalent des geom_xx() dans tmap sont les fonctions suivantes : tm_lines() : afficher des lignes tm_polygons() : afficher des polygones tm_raster() : afficher un raster tm_bubbles() : afficher des ronds proportionnels tm_markers() : afficher des marqueurs tm_text() : afficher du texte Pour charger une donnée géométrique, il faut utiliser la fonction tm_shape() Les différences : - Les variables s’appellent avec des cotes &quot;&quot; Le facetting peut se faire sur un format de données large (une carte par colonne et non une carte par modalité d’une variable) La grande différence entre les tm_xx() et les geom_xx(), c’est que les tm_xx() inclus la définition des classes (nombre de classe, définition des classes et des palettes) sans passer par une fonction scale() dont l’équivalant n’existe pas. La mise en page se définit avec la fonction tm_layout(), la légende avec tm_legend() 13.2.1 Exemple de carte choroplèthe tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;) L’option n= permet de sélectionner le nombre de classes souhaitées, lorsque l’on réalise une carte sur une variable continue. tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,n=2) 13.2.2 Exemple de carte à ronds proportionnels tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons()+ tm_bubbles(size=&quot;Value&quot;,col=&quot;Value&quot;) 13.2.3 Exemples de cartes avec facet tm_shape(tt)+ tm_polygons(&quot;Value&quot;)+ tm_facets(&quot;Year&quot;) tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;)+ tm_facets(&quot;Continent&quot;) 13.2.4 Gestion des palettes La fonction tmaptools::palette_explorer() permet d’accéder à une interface très simple de définition d’une palette de couleurs à partir des palettes brewer. tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,palette=get_brewer_pal(&quot;OrRd&quot;, n = 5, contrast = c(0.2, 1))) On peut également utiliser n’importe quelle palette. Par exemple, la palette viridis, mais sans l’interface proposée par palette_explorer() : tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;)) 13.2.5 La mise en page tm_layout() permet de controler les polices, la légende, les marges, les couleurs. L’option design.mode=T permet de voir visuellement les marges, la position de la légende. Le titre de la légende ne se définit pas dans tm_layout(), mais dans tm_polygons(). L’option title de ces fonctions est l’équivalent d’un libellé de la variable mise dans l’aesthetic. tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;), title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;)+ tm_layout(main.title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances) dans le monde&quot;, main.title.size=1.2, outer.margins=c(0,0,0,0), legend.position=c(&quot;left&quot;,&quot;bottom&quot;), legend.outside = F, main.title.position = &quot;center&quot;, inner.margins = c(0, 0, 0, 0)) Avec les cartes en ronds proportionnels, on peut spécifier un titre pour la couleur et la taille du rond. tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons()+ tm_bubbles(size=&quot;Value&quot;,col=&quot;Value&quot;, palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;), title.col=&quot;&quot;, title.size=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;)+ tm_layout(main.title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances) dans le monde&quot;, main.title.size=1.2, outer.margins=c(0,0,0,0), legend.position=c(&quot;left&quot;,&quot;bottom&quot;), legend.outside = F, main.title.position = &quot;center&quot;, inner.margins = c(0, 0, 0, 0)) 13.2.6 Export d’un graphique La fonction tmap_save() permet d’exporter une carte tmap en un fichier image. carte&lt;-tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons()+ tm_bubbles(size=&quot;Value&quot;,col=&quot;Value&quot;, palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;), title.col=&quot;&quot;, title.size=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;)+ tm_layout(main.title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances) dans le monde&quot;, main.title.size=1.2, outer.margins=c(0,0,0,0), legend.position=c(&quot;left&quot;,&quot;bottom&quot;), legend.outside = F, main.title.position = &quot;center&quot;, inner.margins = c(0, 0, 0, 0)) tmap_save(carte,filename=&quot;figures/Taux de mortalité de la mère dans le monde.png&quot;) 13.3 Exercice 5 Produire une carte du Loiret à l’EPCI du taux de logements collectifs dans le parc locatif social. Résultat attendu "],
["creer-des-cartes-avec-ggplot2-et-tmap.html", "Chapitre 14 Créer des cartes avec ggplot2 et tmap 14.1 Faire des cartes avec ggplot2 14.2 Les cartes avec tmap 14.3 Exercice 5", " Chapitre 14 Créer des cartes avec ggplot2 et tmap 14.1 Faire des cartes avec ggplot2 14.1.1 Les cartes choroplèthe ggplot2 intègre une fonction geom permettant l’utilisation de données géomatrique : geom_sf Le premier exemple que nous allons pouvoir voir, c’est une carte choroplèthe data(&quot;World&quot;) tt&lt;-World %&gt;% rename(Country_or_Area_Code=iso_a3) %&gt;% inner_join(indicateur311 %&gt;% filter(Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Type_Zone==&quot;Pays&quot;, is.na(Value_type)) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(!is.na(Value)) %&gt;% filter(Year==max(Year))) ggplot(data=tt)+ geom_sf(aes(fill=Value)) On peut exploiter de la même façon les différents fonctions vue précédement. Par exemple avec un peu de thème et de facet. data(&quot;World&quot;) World&lt;-st_as_sf(World) tt&lt;-World %&gt;% rename(Country_or_Area_Code=iso_a3) %&gt;% inner_join(indicateur311 %&gt;% filter(Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Type_Zone==&quot;Pays&quot;, is.na(Value_type)) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(!is.na(Value)) %&gt;% filter(Year %in% c(1990,2000,2010,2015)) %&gt;% ungroup() %&gt;% complete(Year) ) ggplot(data=tt)+ geom_sf(aes(fill=log(Value)))+ theme_ipsum()+ scale_fill_viridis(option = &quot;magma&quot;, direction=1, breaks=c(0,1,2,3,4,5,6,7))+ guides(colour=F, order=0, fill=guide_legend(direction=&quot;horizontal&quot;, keyheight=unit(2,units=&quot;mm&quot;), keywidth=unit(20,units=&quot;mm&quot;), order=1, title.position=&quot;top&quot;, title.hjust=0.5, nrow=1, label.position=&quot;bottom&quot;, label.hjust=1))+ theme(legend.position = &quot;bottom&quot;)+ labs(fill=&quot;Log du taux de mortalité infantile&quot;)+ facet_wrap(~Year,drop=T) 14.1.2 Les cartes à ronds proportionnels ggplot ne peut attribuer par défaut un rond proportionnel à un polygone. pour travailler sur des ronds proportionnels,il faut d’abord créer le centroid de nos zones et ensuite tracer un rond proportionnel avec geom_sf. data(&quot;World&quot;) World&lt;-st_as_sf(World) tt&lt;-World %&gt;% rename(Country_or_Area_Code=iso_a3) %&gt;% inner_join(indicateur311 %&gt;% filter(Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Type_Zone==&quot;Pays&quot;, is.na(Value_type)) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(!is.na(Value)) %&gt;% filter(Year==max(Year))) ttc&lt;-st_centroid(tt) ggplot(data=ttc)+ geom_sf(data=tt,fill=&quot;white&quot;)+ geom_sf(aes(color=Value,size=Value)) Attention: les centroids ne sont pas forcément là où on le pense: par exemple, le centroid de la France est décalé en Espagne puisqu’il prend en compte les DOM. 14.2 Les cartes avec tmap Tmap est un package dédié à la réalisation de carte sous R. La syntaxe est très proche de ggplot,avec l’opérateur “+” pour enchainer les options. L’équivalent des geom_xx() dans tmap sont les fonctions suivantes : tm_lines() : afficher des lignes tm_polygons() : afficher des polygones tm_raster() : afficher un raster tm_bubbles() : afficher des ronds proportionnels tm_markers() : afficher des marqueurs tm_text() : afficher du texte Pour charger une donnée géométrique, il faut utiliser la fonction tm_shape() Les différences : - Les variables s’appellent dans des cotes &quot;&quot; Le facetting peut se faire sur un format de données large (une carte par colonne et non une carte par modalité d’une variable) La grande différence entre les tm_xx() et les geom_xx(), c’est que les tm_xx() inclus la définition des classes (nombre de classe, définition des classes et des palettes) sans passer par une fonction scale() dont l’équivalant n’existe pas. La mise en page se définit avec la fonction tm_layout(), la légende avec tm_legend() 14.2.1 Exemple de carte choroplèthe tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;) l’option n= permet de sélectionner le nombre de classes souhaitées lorsque l’on réalise une carte sur une variable continue tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,n=2) 14.2.2 Exemple de carte à ronds proportionnels tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons()+ tm_bubbles(size=&quot;Value&quot;,col=&quot;Value&quot;) 14.2.3 Exemples de cartes avec facet tm_shape(tt)+ tm_polygons(&quot;Value&quot;)+ tm_facets(&quot;Year&quot;) tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;)+ tm_facets(&quot;Continent&quot;) 14.2.4 gestion des palettes la fonction tmaptools::palette_explorer() permet d’accéder à une interface très simple de définition d’une palette de couleur à partir des palette brewer. tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,palette=get_brewer_pal(&quot;OrRd&quot;, n = 5, contrast = c(0.2, 1))) On peut également utiliser n’importe qu’elle palette, par exemple la pelette viridis, mais sans l’interface proposée par palette_explorer() : tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;)) 14.2.5 La mise en page tm_layout() permet de controler les polices, la légende, les marges, les couleurs. l’option design.mode=T permet de voir visuellement les marges,la position de la légende. Le titre de la légende ne se défini pas dans tm_layout() mais dans tm_polygons(). L’option title de ces fonctions est l’équivalent d’un libellé de la variable mise dans l’aesthetic. tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons(&quot;Value&quot;,palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;), title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;)+ tm_layout(main.title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances) dans le monde&quot;, main.title.size=1.2, outer.margins=c(0,0,0,0), legend.position=c(&quot;left&quot;,&quot;bottom&quot;), legend.outside = F, main.title.position = &quot;center&quot;, inner.margins = c(0, 0, 0, 0)) Avec les cartes en ronds proportionnels,on peut spécifier un titre pour la couleur et la taille du rond. tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons()+ tm_bubbles(size=&quot;Value&quot;,col=&quot;Value&quot;, palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;), title.col=&quot;&quot;, title.size=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;)+ tm_layout(main.title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances) dans le monde&quot;, main.title.size=1.2, outer.margins=c(0,0,0,0), legend.position=c(&quot;left&quot;,&quot;bottom&quot;), legend.outside = F, main.title.position = &quot;center&quot;, inner.margins = c(0, 0, 0, 0)) 14.2.6 Exporter une carte tmap La fonction tmap_save() permet d’exporter une carte tmap en fichier image. carte&lt;-tm_shape(tt %&gt;% filter(Year==2015))+ tm_polygons()+ tm_bubbles(size=&quot;Value&quot;,col=&quot;Value&quot;, palette=viridis(5, alpha = 1, begin = 0, end = 1, direction = 1, option = &quot;D&quot;), title.col=&quot;&quot;, title.size=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;)+ tm_layout(main.title=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances) dans le monde&quot;, main.title.size=1.2, outer.margins=c(0,0,0,0), legend.position=c(&quot;left&quot;,&quot;bottom&quot;), legend.outside = F, main.title.position = &quot;center&quot;, inner.margins = c(0, 0, 0, 0)) tmap_save(carte,filename=&quot;figures/Taux de mortalité de la mère dans le monde.png&quot;) 14.3 Exercice 5 Produire une carte du Loiret à l’EPCI du taux de logements collectifs dans le parc locatif social. Résultat attendu "],
["animer-ses-graphiques-ggplot-avec-gganimate.html", "Chapitre 15 Animer ses graphiques ggplot avec gganimate 15.1 Produire une animation 15.2 Paramétrer l’animation 15.3 Exporter une animation 15.4 Exercice 6", " Chapitre 15 Animer ses graphiques ggplot avec gganimate Le package gganimate permet d’enrichir ggplot avec des fonctionnalités d’animation. 15.1 Produire une animation Nous allons voir comment animer notre premier graphique sur la répartition des pays en fonction du taux de mortalité et du PIB, en regardant comment celui ci évolue avec les années. Pour cela, nous partons des même données mais définies pour l’ensemble des années depuis 1990. ggplot(data = graphique_anime) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En 2015&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU\\n échelle logarithmique&quot;) Le graphique précédent est bien sûr illisible, un même pays voit ces données affichées pour toutes les années. Nous allons utiliser la fonction transition_states() du package gganimate pour lui définir l’année comme la frame de notre graphique animé. anim &lt;- ggplot(data = graphique_anime) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent)) + labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En {closest_state}&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU\\n échelle logarithmique&quot;)+ transition_states(states=Year, transition_length = 1, state_length = 2) anim Transition_states() peut s’assimiler à la création de facettes, mais qui vont être ensuite utilisées pour créer une animation. Les options permettant de paramétrer cette animation: states: le nom de la colonne qui va définir nos états transition_length : la durée relative de la transition state_length : la durée relative de la pause entre les transitions wrap : booléen qui défini si l’animation tourne en boucle ou non. La variable *closest state&quot; nous permet d’utiliser ici l’état pour l’afficher en sous-titre. gganimate possède encore bien d’autres fonctionnalités pour définir son animation, notamment : ease_aes() permet de définir comment le graphique change entre deux états : progression linaire, progression qui accélère entre le début et la fin… enter_xx() et exit_xx() permette de définir comment les objets apparaissent et disparaissent quand on change d’état. On peut utiliser gganimate avec des facettes. anim_facet &lt;- ggplot(data = graphique_anime) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent)) + labs(title=&quot;Mortalité maternelle en fonction du PIB par habitant&quot;, subtitle=&quot;En {closest_state}&quot;, x=&quot;PIB&quot;, y=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;, caption=&quot;Source : ODD / ONU\\n échelle logarithmique&quot;)+ facet_wrap(~Continent) + transition_states(states=Year, transition_length = 1, state_length = 2) anim_facet 15.2 Paramétrer l’animation La fonction animate() permet de paramétrer notre animation. Notamment: - le moteur de rendu - le nombre de frames à créer - le frame rate - la durée Ici par exemple, nous paramétrons le rendu pour supprimer la boucle d’animation (loop=FALSE) animate(anim,renderer=gifski_renderer(file = tempfile(fileext = &quot;.gif&quot;), loop = FALSE, width = NULL, height = NULL) ) 15.3 Exporter une animation La fonction anime_save() permet de sauvegarder nos animations sous différent format à définir via le moteur de rendu. Par défaut, elle sauvegarde la dernière animation. anim_save(&quot;figures/ma_super_animation.gif&quot;) 15.4 Exercice 6 Produire le nuage de points du croisement de la part communale des logements ayant une étiquette A,B,C en fonction de la part communale du parc récent. Créer une animation par département uniquement pour ceux de la région Centre-Val de Loire. Le résultat attendu : "],
["creer-des-graphiques-et-cartes-pour-le-web.html", "Chapitre 16 Créer des graphiques et cartes pour le web 16.1 Highcharter 16.2 Les cartes Leaflet 16.3 Exporter une sortie html 16.4 Exercice 7", " Chapitre 16 Créer des graphiques et cartes pour le web 16.1 Highcharter Highcharter(http://jksunk.com.highcharter) est un module qui permet d’exploiter la librairie Highcharts en R. La syntaxe obéi en partie à la même logique que ggplot : Définition d’un géom; Définition d’une aesthétique. La différence avec ggplot2 : tout se fait dans une seule fonction (hchart()) le %&gt;% remplace le + La syntaxe de hchart est la suivante : hchart(MA_TABLE,&quot;MON_TYPE_DE_GRAPHIQUE&quot;,hcaes(MON_AESTHETIC)) Quelques graphiques possibles : Type de graphique Nom Nuage de point scatter Diagramme barre column ou bar Ligne line Aire area Camenbert pie Treemap treemap Radar polarline 16.1.1 Exemple type de graphique Voici un exemple de diagramme barre sur les données de mortalités. highchart&lt;-indicateur311 %&gt;% filter(Type_Zone != &quot;Pays&quot;, Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Location==&quot;Total (national level)&quot; ) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(Year==max(Year)) %&gt;% ungroup hchart(highchart,&quot;bar&quot;,hcaes(x=Country_or_Area_Name,y=Value,color=Country_or_Area_Name)) %&gt;% hc_colors(plasma(n=5)) %&gt;% hc_plotOptions(series=list(shadow=&#39;true&#39;)) %&gt;% hc_title(text=&quot;Mortalité maternelle sur quelques zones du globe&quot;, align = &quot;left&quot;,style=list(color = &quot;#2b908f&quot;, fontWeight = &quot;bold&quot;,fontFamily = &#39;Courier New&#39;)) %&gt;% hc_subtitle(text=&quot;En 2015&quot;,align=&quot;left&quot;,style=list(color = &quot;#2b908f&quot;)) %&gt;% hc_xAxis(title=list(text=&quot;Zone&quot;)) %&gt;% hc_yAxis(title=list(text=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;)) %&gt;% hc_tooltip( pointFormat = &#39;&lt;b&gt;{point.name}&lt;/b&gt;&lt;br/&gt;{point.y} décès pour 100 000 naissances&#39; ) Quelques définitions des options utilisées ici : hc_colors() permet de définir les couleurs utlisées. elle prend en paramètre un vecteur de couleur de longueur égal à celui des modalités différentes de la variable utilisée dans l’aesthétique pour la couleur. hc_plotOptions() permet de définir les options globales du graphique. 2 niveaux d’options peuvent être définies avec hcchart : celles s’appliquant à toute les séries de données, doivent être définies dans le paramètre series celles s’appliquant aux séries de données d’un type particulier, doivent être définies dans le paramètre correspondant au nom de ce type, exemple, pour un graphique barre bar=. hc_title() et hc_subtitle() permettent de définir le titre et le sous-titre: texte, alignement, marge, style (couleur,police…) hc_xAxis() hc_yAxis() permet de définir les options de mise en forme des axes : titre des axes, bornes, formats d’affichage, … hc_tooltip() permet de définir l’infobulle qui s’affiche : activation/désactivation,apparence, contenu. Ici l’option pointFormat nous permet de mieux définir le libellé. Voici un exemple de graphique en ligne hchart(graphique2,&quot;line&quot;,hcaes(x=Year,y=Value,color=Country_or_Area_Name)) %&gt;% hc_title(text=&quot;Evolution de la mortalité maternelle dans le monde&quot;,align = &quot;left&quot;) %&gt;% hc_subtitle(text=&quot;Entre 2000 et 2015&quot;,align=&quot;left&quot;) %&gt;% hc_yAxis(title=list(text=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;),min=0,alternateGridColor=&#39;#FDFFD5&#39;) %&gt;% hc_xAxis(title=list(text=&quot;Année&quot;)) %&gt;% hc_tooltip( pointFormat = &#39;&lt;b&gt;{point.name}&lt;/b&gt;&lt;br/&gt;{point.y} décès pour 100 000 naissances&#39; ) %&gt;% hc_colors(plasma(n=5)) Les options de highcharter sont extrèmements nombreuses, highcharter étant basée sur highcharts, mais peu documentées. Le plus simple est de se référer à la documentation de l’API Highcharts pour prendre connaissance des options possible et de voir ensuite comment adapter ce code dans highcharter. 16.1.2 Les facettes Highcharter permet de réaliser des graphiques à facette à partir d’une liste de graphiques réalisés avec Highcharter. La fonction permettant cela est la fonction hw_grid() #définition de la table de donnée highchart_liste&lt;-indicateur311 %&gt;% filter(Type_Zone != &quot;Pays&quot;, Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Location==&quot;Total (national level)&quot;, Year&gt;=2000 ) #Création de la liste des graphiques highcharts map(unique(highchart_liste$Country_or_Area_Name), function(x){ highchart_liste %&gt;% filter(Country_or_Area_Name==x) %&gt;% hchart(&quot;scatter&quot;,hcaes(x=Year,y=Value,color=Country_or_Area_Name), showInLegend = FALSE) %&gt;% hc_title(text=glue(&quot;Evolution de la mortalité maternelle - {x}&quot;),align = &quot;left&quot;) %&gt;% hc_subtitle(text=&quot;Entre 2000 et 2015&quot;,align=&quot;left&quot;) %&gt;% hc_yAxis(title=list(text=&quot;Taux de mortalité de la mère \\n(pour 100 000 naissances)&quot;),min=0, max=400) %&gt;% hc_xAxis(title=list(text=&quot;Année&quot;)) %&gt;% hc_tooltip( pointFormat = &#39;&lt;b&gt;{point.name}&lt;/b&gt;&lt;br/&gt;{point.y} décès pour 100 000 naissances&#39; ) }) %&gt;% hw_grid(ncol = 3,rowheight=250) 16.2 Les cartes Leaflet Leaflet est au départ un package de cartographique réalisé en javascript. R permet de produire des cartes en exploitant cette librairie. Ci-dessous un exemple avancé de carte choroplète avec leaflet. tt&lt;-World %&gt;% rename(Country_or_Area_Code=iso_a3) %&gt;% left_join(indicateur311 %&gt;% filter(Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Type_Zone==&quot;Pays&quot;, is.na(Value_type)) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(!is.na(Value)) %&gt;% filter(Year==max(Year))) # création des quantiles de la variable d&#39;intérêt bins &lt;-quantile(tt$Value,na.rm=T) # création d&#39;une palette de couleurs associée pal &lt;- colorBin(&quot;YlOrRd&quot;, domain = tt$Value, bins = bins) #création d&#39;un label ad hoc à afficher en surbrillance au passage de la souris sur la carte. labels &lt;- sprintf( &quot;&lt;strong&gt;%s&lt;/strong&gt;&lt;br/&gt;%g décès pour 100 000 naissance en 2015&quot;, tt$name, tt$Value ) %&gt;% lapply(htmltools::HTML) #transformation de la projection nécessaire pour certaines cartes car Leaflet ne connait que le WGS 84 tt&lt;-st_transform(tt,crs=(&quot;+proj=longlat +datum=WGS84 +no_defs&quot;)) leaflet(tt) %&gt;% addPolygons(data=tt, fillColor=~pal(Value), weight = 2, opacity = 1, color = &quot;white&quot;, dashArray = &quot;3&quot;, fillOpacity = 0.7, highlight = highlightOptions( weight = 5, color = &quot;#666&quot;, dashArray = &quot;&quot;, fillOpacity = 0.7, bringToFront = TRUE), label = labels, labelOptions = labelOptions( style = list(&quot;font-weight&quot; = &quot;normal&quot;, padding = &quot;3px 8px&quot;), textsize = &quot;15px&quot;, direction = &quot;auto&quot;)) Pour réaliser des ronds proportionnel, il va falloir la aussi créer un centroide de nos polygones ttc&lt;-st_centroid(tt) bins &lt;-quantile(ttc$Value,na.rm=T) pal &lt;- colorBin(&quot;YlOrRd&quot;, domain = ttc$Value, bins = bins) carte_rond_proportionnel&lt;-leaflet(ttc) %&gt;% addPolygons(data=tt, fillColor = &quot;#ffffff&quot;, opacity=.2, color = &quot;white&quot;, dashArray = &quot;3&quot;, fillOpacity = 0.7 ) %&gt;% addCircles(data=ttc, fillColor=~pal(Value), radius=~100000*log2(Value), weight = 2, opacity = 1, color = &quot;white&quot;, dashArray = &quot;3&quot;, fillOpacity = 0.7, highlight = highlightOptions( weight = 5, color = &quot;#666&quot;, dashArray = &quot;&quot;, fillOpacity = 0.7, bringToFront = TRUE), label = labels, labelOptions = labelOptions( style = list(&quot;font-weight&quot; = &quot;normal&quot;, padding = &quot;3px 8px&quot;), textsize = &quot;15px&quot;, direction = &quot;auto&quot;)) %&gt;% addLegend(&quot;bottomright&quot;, pal = pal, values = ~Value, title = &quot;Taux de décès des mères à la naissance&quot;, opacity = 1) 16.3 Exporter une sortie html La foncion saveWidget permet d’exporter une sotie d’un html Widget en html. saveWidget(widget=carte_rond_proportionnel,file=&quot;Taux de décès des mères à la naissance.html&quot;) 16.4 Exercice 7 Reprendre le nuage de point obtenu à partir des données ODD :taux de mortalité maternelle (Maternal_mortality_ratio) en fonction du produit intérieur brut (Gross_Domestic_Product_GDP) (Chapitre 4.1) Obtenir ce graphique pour le web avec des infos bulles regroupant le nom du continent, de la zone et les données associées Le résultat attendu : "],
["creer-des-tableaux-avec-kable-et-kable-extra.html", "Chapitre 17 Créer des tableaux avec kable et kable extra 17.1 Exercice 8", " Chapitre 17 Créer des tableaux avec kable et kable extra Kable permet de créer des tableaux de diffusion très simplement. Une très bonne documentation en anglais peut se trouver ici Ci-dessous un exemple. On reprend les données utilisées pour le diagramme barre. indicateur311 %&gt;% filter(Type_Zone != &quot;Pays&quot;, Age_group==&quot;All age ranges or no breakdown by age&quot;, Sex==&quot;Both sexes or no breakdown by sex&quot;, Location==&quot;Total (national level)&quot;, is.na(Value_type) ) %&gt;% group_by(Country_or_Area_Code) %&gt;% filter(Year==max(Year)) %&gt;% ungroup %&gt;% select(Country_or_Area_Name,Year,Value) %&gt;% setNames(c(&quot;Zone&quot;,&quot;Année&quot;,&quot;Nombre de décès pour 100 000 Naissance&quot;)) %&gt;% kable(&quot;html&quot;,caption=&quot;Mortalité de la mère à la naissance pour quelques grandes zones du globe&quot;) %&gt;% kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;)) %&gt;% row_spec(1, bold = T, color = &quot;white&quot;, background = &quot;grey&quot;)%&gt;% add_indent(c(2:5)) (#tab:kabble_1)Mortalité de la mère à la naissance pour quelques grandes zones du globe Zone Année Nombre de décès pour 100 000 Naissance World 2015 216 Latin America and the Caribbean 2015 67 Southern Asia 2015 176 South-Eastern Asia 2015 110 Oceania (excluding Australia and New Zealand) 2015 187 Description des fonctions utilisées : setNames() permet de définir les libellés de colonnes ; kable(“html”) permet de produire une sortie html du tableau, l’option caption définit le titre ; kable_styling() permet de mettre un thème à notre tableau, ici on lui dit qu’on veut un tableau avec des lignes dont les couleurs alterne entre blanc et gris et un effet de surbrillance au passage de la souris ; row_spec() permet de définir des attributs particuliers pour des lignes. Ici, on lui dit qu’on veut une ligne 1 avec du gras, un fond gris et une police de couleur blanche. L’équivalent pour les colonnes est column_spec(); add_indent() permet de définir sur un vecteur de lignes (ici les lignes 2 à 5) une identation. 17.1 Exercice 8 Produire un tableau du nombre de logements collectifs et individuels (RPLS) par départements en région Centre-Val-de-Loire. Le résultat attendu : (#tab:kabble_2)Chiffres clés RPLS Zone Nombre de logements collectifs Nombre de logements individuels Cher 14434 7054 Eure-et-Loir 24462 7024 Indre 11533 6419 Indre-et-Loire 39030 9779 Loir-et-Cher 14632 6436 Loiret 37442 12671 Centre-Val de Loire 141533 49383 "],
["ressources.html", "Chapitre 18 Ressources 18.1 dataviz 18.2 ggplot2 18.3 tmap 18.4 highcharter 18.5 kable et kableExtra", " Chapitre 18 Ressources Quelques ressources de références 18.1 dataviz Dataviz project : http://datavizproject.com From data to viz : https://www.data-to-viz.com/ Dundamentals of datavisualisation : http://serialmentor.com/dataviz/ Datavizualisation - a practical introduction : http://socviz.co/ 18.2 ggplot2 La documentation du module : http://ggplot2.tidyverse.org/reference/ Cheatsheet : https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf Top 50 ggplot2 visualisations : http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html 18.3 tmap La vignette du package Tmap : https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html 18.4 highcharter Le site web du module : http://jkunst.com/highcharter/ L’api Highcharts : https://api.highcharts.com/highcharts/ 18.5 kable et kableExtra Créer de super tableaux avec kabble et kableExtra : https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html "],
["exercices-et-corrections.html", "Chapitre 19 Exercices et corrections 19.1 Exercice 1 19.2 Exercice 2 19.3 Exercice 3 19.4 Exercice 4 19.5 Exercice 5 19.6 Exercice 6 19.7 Exercice 7 19.8 Exercice 8", " Chapitre 19 Exercices et corrections 19.1 Exercice 1 A partir des données de la table rpls_aggrege_large (dans le data_exercices_formation.RData), créer un nuage de point entre : le % de parc social de moins de 5 ans; et le pourcentage de logement avec un DPE ges de classe A,B ou C; et une couleur différente pour distinguer les epci de la région PDL. ggplot(data = rpls_aggrege_large %&gt;% filter(TypeZone==&quot;Epci&quot;)) + geom_point(aes(x=Parc_de_moins_de_5_ans_pourcent, y=DPE_GES_classe_ABC_pourcent, color=epci_2017_52), alpha=.5, size=.5 ) 19.2 Exercice 2 Reprendre le nuage de point obtenu à partir des données ODD :taux de mortalité maternelle (Maternal_mortality_ratio) en fonction du produit intérieur brut (Gross_Domestic_Product_GDP) (Chapitre 4.1) En modifier le thème: Insérer un titre de couleur, en gras, centré par rapport au graphe. Indiquer la source (ODD) et modifier sa taille Changer les titres des axes et leurs tailles. modifier la couleur de fond du graphe modifier le type de gadrillage (pointillés) ggplot(graphique1) + geom_point(aes(x=log(Gross_Domestic_Product_GDP), y=log(Maternal_mortality_ratio), color=Continent))+ labs(title=&quot;Croisement du PIB avec le taux de mortalité maternelle&quot;, y=&quot;Taux de mortalité maternelle&quot;, x=&quot;Produit Intérieur Brut&quot;, caption=&quot;Source: ODD&quot;)+ theme(plot.title=element_text(size=15, face=&quot;bold&quot;, color=&quot;blue&quot;, hjust=0.5), plot.caption=element_text(size=15), axis.title.x=element_text(size=15), axis.title.y=element_text(size=15), panel.background = element_rect(fill = &quot;lightblue&quot;,colour = &quot;lightblue&quot;,size = 0.5), panel.grid.major = element_line( size=0.5,linetype = &quot;dotted&quot;), panel.grid.minor = element_line( size=0.5,linetype = &quot;dotted&quot;)) 19.3 Exercice 3 En réutilisant le graphe obtenu à l’exercice 1, y rajouter: une palette brewer pour la couleur; la légende en bas; des libellés (axes et légende) parlant et un titre. ggplot(data = rpls_aggrege_large %&gt;% filter(TypeZone==&quot;Epci&quot;)) + geom_point(aes(x=Parc_de_moins_de_5_ans_pourcent, y=DPE_GES_classe_ABC_pourcent, color=epci_2017_52), size=.7 )+ scale_color_brewer(type=qual,palette=&quot;Paired&quot;, labels=c(&quot;Autres Epci&quot;,&quot;Epci de la région Pays de la Loire&quot;))+ scale_x_continuous(limits = c(0,40))+ scale_y_continuous(limits = c(0,80))+ theme(legend.position = &quot;bottom&quot;)+ labs(title=&quot;Répartition des Epci en fonction \\nde la part des logements ayant une étiquette A,B,C et de la part du parc récent&quot;, x=&quot;Part du parc de moins de 5 ans&quot;, y=&quot;Part des logements ayant une étiquette A,B,C&quot;, color=&quot;&quot;) 19.4 Exercice 4 Facette sur un diagramme barre avec : en variable discrète les régions en variables continues les indicateurs suivants : % de logements de 3 et 4 pièces % DPE énergie A,B,C % DPE GES A,B,C % de parc de moins de 5 ans une façon d’identifier la région Pays de la Loire Pour avoir la liste des modalités dune variable : Variables caractères ou factorielles : unique(rpls_aggrege$Indicateur) Variables factorielles : levels(rpls_aggrege$Indicateur) rpls_aggrege %&gt;% filter(TypeZone==&quot;Régions&quot;, Indicateur %in% c(&quot;3 et 4 pièces_pourcent&quot;, &quot;DPE GES classe ABC_pourcent&quot;, &quot;DPE énergie classe ABC_pourcent&quot;, &quot;Parc de moins de 5 ans_pourcent&quot;)) %&gt;% mutate(Indicateur=fct_recode(Indicateur, `Logements de 3 et 4 pièces`=&quot;3 et 4 pièces_pourcent&quot;, `Logements avec DPE énergie de classe A,B,C`=&quot;DPE énergie classe ABC_pourcent&quot;, `Logements avec DPE GES de classe A,B,C`=&quot;DPE GES classe ABC_pourcent&quot;, `Logements social de moins de 5 ans`=&quot;Parc de moins de 5 ans_pourcent&quot;), r52=ifelse(Reg_2017==&quot;52&quot;,1,0)) %&gt;% ggplot()+ #On utilise l&#39;indicatrice de la région Pays de la Loire pour mapper la transparence geom_bar(aes(x=nReg_2017,weight=Valeur,fill=Indicateur,alpha=r52))+ coord_flip()+ theme_ipsum()+ scale_fill_ipsum()+ #On défini les valeurs maximum et minimum de transparence que l&#39;on veut voir scale_alpha_continuous(range=c(.65,1))+ facet_wrap(~Indicateur)+ theme(legend.position=&quot;none&quot;)+ labs(title=&quot;mon premier facet&quot;,y=&quot;En % du parc social&quot;,x=&quot;&quot;) 19.5 Exercice 5 Produire une carte du Loiret à l’EPCI du taux de logements collectifs dans le parc locatif social. tt &lt;- Carte_EPCI_France %&gt;% filter(CODE_DEPT==&quot;45&quot;) %&gt;% left_join(rpls_aggrege) %&gt;% filter(Indicateur==&quot;Logements collectifs_pourcent&quot;) ggplot(data=tt)+ geom_sf(aes(geometry=geometry, fill=Valeur))+ labs(title=&quot;Taux de logements collectifs par EPCI&quot;,subtitle=&quot;Département du Loiret&quot;)+ theme( axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks = element_blank()) 19.6 Exercice 6 Produire le nuage de point du croisement de la part des logements ayant une étiquette A,B,C en fonction de la part du parc récent. Créer une animation par département uniquement pour ceux de la région Centre-Val de Loire. rpls &lt;- rpls_aggrege_large %&gt;% filter(nReg_2017==&quot;Centre-Val de Loire&quot;) %&gt;% mutate(nDep_2017=fct_drop(nDep_2017)) anim&lt;-ggplot(data =rpls ) + geom_point(aes(x=Parc_de_moins_de_5_ans_pourcent, y=DPE_GES_classe_ABC_pourcent))+ labs(title=&quot;Croisement de la part des logements ayant une étiquette A,B,C \\n en fonction de la part du parc récent&quot;, subtitle=&quot;En {closest_state}&quot;, x=&quot;Part du parc de moins de 5 ans&quot;, y=&quot;Part des logements ayant une étiquette A,B,C&quot;, color=&quot;&quot;)+ transition_states(states=nDep_2017, transition_length = 1, state_length = 2) anim 19.7 Exercice 7 Reprendre le nuage de point obtenu à partir des données ODD :taux de mortalité maternelle (Maternal_mortality_ratio) en fonction du produit intérieur brut (Gross_Domestic_Product_GDP) (Chapitre 4.1) Obtenir ce graphique pour le web avec des infos bulles regroupant le nom du continent, de la zone et les données associées hchart(graphique1,&quot;scatter&quot;,hcaes(x=Gross_Domestic_Product_GDP, y=Maternal_mortality_ratio, color=Continent)) %&gt;% hc_plotOptions(series=list(shadow=&#39;false&#39;)) %&gt;% hc_tooltip( pointFormat = &#39;&lt;b&gt;{point.Continent}&lt;/b&gt;&lt;br/&gt;&lt;b&gt;{point.Parent_Zone_libelle}&lt;/b&gt;&lt;br/&gt;PIB de {point.x} un taux de mortalié maternelle de {point.y} (pour 100 000 naissances)&#39; ) 19.8 Exercice 8 Produire un tableau du nombre de logements collectifs et individuels (RPLS) par départements en région Centre-Val de Loire. rpls_DEP_R24 &lt;- rpls_aggrege_large %&gt;% filter(TypeZone %in% c(&quot;Départements&quot;,&quot;Régions&quot;),nReg_2017==&quot;Centre-Val de Loire&quot;) %&gt;% arrange(TypeZone,Zone) %&gt;% select(Zone,Logements_collectifs,Logements_individuels)%&gt;% setNames(c(&quot;Zone&quot;,&quot;Nombre de logements collectifs&quot;,&quot;Nombre de logements individuels&quot;)) %&gt;% kable(&quot;html&quot;,caption=&quot;Chiffres clés RPLS&quot;) %&gt;% kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;)) %&gt;% row_spec(7, bold = T, color = &quot;white&quot;, background = &quot;grey&quot;) rpls_DEP_R24 Table 19.1: Chiffres clés RPLS Zone Nombre de logements collectifs Nombre de logements individuels Cher 14434 7054 Eure-et-Loir 24462 7024 Indre 11533 6419 Indre-et-Loire 39030 9779 Loir-et-Cher 14632 6436 Loiret 37442 12671 Centre-Val de Loire 141533 49383 "]
]
